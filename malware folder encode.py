import os
from hashlib import sha256
from base64 import b64encode

path = input("Enter path: ")

# Check if the path exists and is a directory
if not os.path.exists(path) or not os.path.isdir(path):
    print("Invalid path. Please provide a valid directory.")
    exit()

# Function to hash and rename files
def process_file(file_path):
    try:
        with open(file_path, 'r+b') as f:
            # Read content and compute SHA256 hash
            content = f.read()
            hash_value = sha256(content).hexdigest()
            
            # Overwrite file with the hash
            f.seek(0)
            f.write(hash_value.encode())
            f.truncate()

        # Generate base64-encoded filename and preserve extension
        base64_name = b64encode(os.path.basename(file_path).encode()).decode('utf-8')
        extension = os.path.splitext(file_path)[1]
        new_file_path = os.path.join(os.path.dirname(file_path), f"{base64_name}{extension}")
        
        # Rename file
        os.rename(file_path, new_file_path)
        print(f"Processed file: {file_path} -> {new_file_path}")

    except Exception as e:
        print(f"Error processing file {file_path}: {e}")

# Function to iterate over directory contents
def process_directory(current_path):
    try:
        for entry in os.scandir(current_path):
            if entry.is_dir():
                # Recursively process subdirectories
                process_directory(entry.path)
            elif entry.is_file():
                # Process individual files
                process_file(entry.path)
    except Exception as e:
        print(f"Error processing directory {current_path}: {e}")

# Process the provided directory
process_directory(path)


# 1. check if does not exists or is file -> exit 
# 2. itirate over content
# 3. if folder
## 3.1. go to step 2
# 4. if file 
## 4.1. open file with w+ mode
## 4.2. read content
## 4.3. sha256 hash the content
## 4.4. overwrite file with hash
## 4.5. rename file with <base64_filename>.<extension>
## 
# 
# 
# 
# 
#     